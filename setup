#!/bin/bash
SCRIPTPATH="$( cd "$(dirname "$0")" ; pwd -P )"
FILES=$(find home ! -path home -type f)
COUNT=0

mkdir -p ~/.vim/tmp/undo
mkdir -p ~/.vim/tmp/backup
mkdir -p ~/.vim/tmp/swap

for LIBFILE in $FILES; do
    FILE=${LIBFILE:4}
    DIR=$(dirname "$HOME/$FILE")
    BACKUPFILE="$SCRIPTPATH/back/$FILE"
    BACKUPDIR=$(dirname "$SCRIPTPATH/back/$FILE")

    mkdir -p "$DIR"
    mkdir -p "$BACKUPDIR"

    if [ -f "$HOME/$FILE" ]; then
        cp "$HOME/$FILE" "$BACKUPFILE"
        rm "$HOME/$FILE"
    fi

    ln -s -f "$SCRIPTPATH/home/$FILE" "$HOME/$FILE" 2>&1 >/dev/null
    ((COUNT++))
    echo -e -n "\e[36mUpdated $COUNT files.\e[0m\r"
done
echo -e "\e[36mUpdated $COUNT files.\e[0m"
